{^{async data}}
  <div class="row">
    <div class="col-sm-10">
      <h2 class="page-heading">Edit Group</h2>
    </div>
    <div class="col-sm-2 text-right">
      <div class="btn-group-vertical">
        <button type="button" class="btn btn-info" id="group-finish-editing">Finish</button>
      </div>
    </div>
  </div>

  <div class="tabbable">
    <ul class="nav nav-tabs">
      <li class="active"><a href="#group-basics" data-toggle="tab">Basics</a></li>
      <li><a href="#group-icon" data-toggle="tab">Icon</a></li>
      <li><a href="#group-members" data-toggle="tab">Members</a></li>
    </ul>

    <div class="tab-content">
      <div class="tab-pane active" id="group-basics">
        <form role="form">
          {^{if ~isEmpty(groupErrors.name)}}
            <div class="form-group" style="width:300px;">
              <label class="control-label">Name</label>
              <input type="text" class="form-control" placeholder="Group Name" data-link="group.name">
            </div>
          {{else}}
            <div class="form-group has-error has-feedback" style="width:300px;">
              <label class="control-label">Name</label>
              <input type="text" class="form-control" placeholder="Group Name" data-link="group.name">
              <span class="glyphicon glyphicon-remove form-control-feedback"></span>
            </div>
            <p class="text-danger" data-link="groupErrors.name"></p>
          {{/if}}
          {^{if ~isEmpty(groupErrors.description)}}
            <div class="form-group" style="width:600px;">
              <label class="control-label">Description</label>
              <textarea class="form-control" row="3" data-link="group.description"></textarea>
            </div>
          {{else}}
            <div class="form-group has-error has-feedback" style="width:600px;">
              <label class="control-label">Description</label>
              <textarea class="form-control" row="3" data-link="group.description"></textarea>
              <span class="glyphicon glyphicon-remove form-control-feedback"></span>
            </div>
            <p class="text-danger" data-link="groupErrors.description"></p>
          {{/if}}
        </form>
        <div class="row">
          <p class="col-sm-12">
            <a href="javascript:void 0;" class="btn btn-primary" data-loading-text="Saving..." id="group-basics-submit">Save</a>
          </p>
        </div>
      </div>

      <div class="tab-pane" id="group-icon">
        <div class="form-group">
          <div>
            <img data-link="src{>group.primaryImage.url}" alt="icon">
          </div>
        </div>
        <form role="form" id="group-icon-form">
          <div class="form-group">
            <div><label class="control-label">Change icon</label></div>
            <div>
              <input type="file" name="images[]" style="display:inline;">
              <a href="javascript:void 0;" class="btn btn-primary btn-sm" data-loading-text="Saving..." id="group-icon-submit" style="display:none;">Upload</a>
            </div>
          </div>
        </form>
      </div>

      <div class="tab-pane" id="group-members">
        {^{async members}}
          <div style="margin-bottom: 10px">
            <a class="btn btn-default" data-toggle="modal" href="#add-member-dialog"><span class="glyphicon glyphicon-plus"></span></a>
          </div>
          <table class="table table-striped">
            <tbody>
              {^{for items ~myself=#parent.data.myself}}
                <tr>
                  <td>
                    <div class="media">
                      <div class="pull-left">
                        <img src="{{>image}}/48"/>
                      </div>
                      <div class="media-body">
                        <h4 class="media-heading"><strong>{{>fullname}}</strong> <small>{{>name}} &raquo; {{>organization}} {{>title}}</small></h4>
                        <p>{{>description}}</p>
                      </div>
                    </div>
                  </td>
                  <td>
                    {{if ~myself.id == id && role == 2}}
                      Manger
                    {{else}}
                      <select class="form-control" style="width:auto;" data-link="{:role:toInt}">
                        <option value="2">Manger</option>
                        <option value="1">Member</option>
                      </select>
                    {{/if}}
                  </td>
                  <td>
                    {{if ~myself.id != id}}
                      <button class="btn btn-default" data-remove="{{>id}}"><span class="glyphicon glyphicon-trash"></span></button>
                    {{/if}}
                  </td>
                </tr>
              {{/for}}
            </tbody>
          </table>
          {^{pagination index pages id="member-pagination" pagedelta=5 /}}

          <div class="row" style="margin-top: 8px;">
            <div class="col-sm-12">
              <button type="button" class="btn btn-primary btm-sm" id="group-member-submit">Save</button>
            </div>
          </div>
        {{/async}}
      </div>
    </div>
  </div>
{{/async}}

<!-- modal -->
<div id="add-member-dialog" class="modal fade" tabindex="-1" data-width="600" data-keyboard="false" data-backdrop="static" style="display: none;">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
    <h4 class="modal-title">Add group member</h4>
  </div>

  <div class="modal-body">
    <form id="member-search-form" class="container-fluid" style="margin-bottom: 10px;">
      <div class="row">
        <div class="input-group" style="float:left; width: 300px;">
          <input type="text" class="form-control" placeholder="filter" data-link="memberCandidate.query">
          <span class="input-group-btn">
            <button class="btn btn-primary" type="submit"><span class="glyphicon glyphicon-search"></span></button>
          </span>
        </div>
      </div>
    </form>

    {^{for memberCandidate.items}}
      <div class="media">
        <div class="pull-left">
          {^{checkButton selected/}}
          <img src="{{:item.image}}/48"/>
        </div>
        <div class="media-body">
          <h4 class="media-heading"><strong>{{>item.fullname}}</strong> <small>{{>item.name}} &raquo; {{>item.organization}} {{>item.title}}</small></h4>
          <p>{{>item.description}}</p>
        </div>
      </div>
    {{/for}}
    {^{range ^start=memberCandidate.items.length end=5}}
      <div class="media" style="visibility: hidden;">
        <div class="media-body">
          <h4 class="media-heading">&nbsp;</h4>
          <p>&nbsp;</p>
        </div>
      </div>
    {{/range}}

    <div class="text-right">
      <button id="member-list-prev" class="btn btn-default btn-sm" type="button" data-link="disabled{:!memberCandidate.hasPrev}">&larr; Prev</button>
      <button id="member-list-next" class="btn btn-default btn-sm" type="button" data-link="disabled{:!memberCandidate.hasNext}">Next &rarr;</button>
    </div>
  </div>

  <div class="modal-footer">
    <input type="checkbox"/>add as manager
    <button type="button" class="btn btn-primary" data-loading-text="Saving..." id="add-member-dialog-submit" data-link="disabled{:memberCandidate.selectedIds.length <= 0}">Apply</button>
    <button type="button" data-dismiss="modal" class="btn btn-default">Cancel</button>
  </div>
</div>